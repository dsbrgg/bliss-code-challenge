var blissApp=angular.module("blissApp",["ngRoute","ngResource","ngCookies"]);blissApp.run(function($window,$rootScope,$cookies,$location){$cookies.put("offset",0),$rootScope.online=navigator.onLine,$window.addEventListener("offline",function(){$rootScope.$apply(function(){$rootScope.online=!1,$cookies.put("lastState",$location.absUrl()),alert("There's seems to be a problem in the connection. Don't worry, we've managed to save your progress when everything gets normal again."),$location.path("/noConnection")})},!1),$window.addEventListener("online",function(){$rootScope.$apply(function(){var cookie=$cookies.get("lastState");$rootScope.online=!0,cookie&&$location.path(cookie)})},!1)}),blissApp.controller("statusController",["$scope","$location","blissAPI",function($scope,$location,blissAPI){"OK"===$scope.status&&(console.log("teste"),$location.path("/questions")),blissAPI.ServerHealth().$promise.then(function(health){"OK"===health.status?($scope.status=health.status,$location.path("/questions")):alert(health.status)}).catch(function(err){alert("Unable to get server status : ",err)})}]),blissApp.controller("questionsController",["$scope","$location","$route","blissAPI","shareService","detailService","$cookies",function($scope,$location,$route,blissAPI,shareService,detailService,$cookies){var questionFilter=$location.search().question_filter,offset=parseInt($cookies.get("offset")),queryString="string"==typeof questionFilter?questionFilter:"";$scope.previousPage=function(){offset=$cookies.put("offset",offset-5),$route.reload()},$scope.nextPage=function(){offset=$cookies.put("offset",offset+5),$route.reload()},$scope.submit=function(){queryString=$scope.filter,$location.path("/questions").search("question_filter",queryString)},$scope.shareRedirect=function(obj){shareService.obj=obj,$location.path("/share")},$scope.detailRedirect=function(obj){detailService.obj=obj,$location.path("/questions/"+obj.id)};blissAPI.ListQuestions(offset,queryString).$promise.then(function(response){var filteredArray=response.filter(function(f){return"object"==typeof f});$scope.responseQuestions=filteredArray}).catch(function(err){alert(err)})}]),blissApp.controller("detailsController",["$scope","$route","$location","blissAPI","detailService","shareService",function($scope,$route,$location,blissAPI,detailService,shareService){var fullPath=$location.path().split("/"),questionId=fullPath[fullPath.length-1];$scope.upvotes=function(id){id=id.split(":")[1],blissAPI.UpvoteChoice(id).then(function(response){201===response.status&&(alert("Thanks for sharing your opinion!"),$route.reload())}).catch(function(err){alert("Sorry, there was an error in the request. Try again later. ",err)})},$scope.shareQuestion=function(){$scope.obj=shareService.obj,$location.path("/share")},blissAPI.QuestionDetails(questionId).then(function(response){$scope.obj=response.data,shareService.obj=response.data}).catch(function(err){alert("Sorry, your request could not be made. Try again later. ",err)})}]),blissApp.controller("shareController",["$scope","$location","blissAPI","shareService",function($scope,$location,blissAPI,shareService){$scope.obj=shareService.obj,$scope.request=function(){blissAPI.Share().then(function(response){"OK"===response.data.status&&(alert("Question shared successfully!"),$location.path("/questions"))}).catch(function(err){alert("Sorry, your request could not be made. Try again later. ",err)})}}]),blissApp.directive("questionList",function(){return{restrict:"E",templateUrl:"directives/questionList.htm",replace:!1,scope:{item:"=",shareRedirect:"&",detailRedirect:"&"}}}),blissApp.config(function($routeProvider,$locationProvider){$locationProvider.hashPrefix(""),$routeProvider.when("/",{templateUrl:"pages/loadingScreen.htm",controller:"statusController"}).when("/questions",{templateUrl:"pages/questionsScreen.htm",controller:"questionsController"}).when("/questions/:id",{templateUrl:"pages/detailScreen.htm",controller:"detailsController"}).when("/share",{templateUrl:"pages/shareScreen.htm",controller:"shareController"}).when("/connect",{templateUrl:"pages/noConnectionScreen.htm"})}),blissApp.service("blissAPI",["$resource","$http",function($resource,$http){var url="https://private-bbbe9-blissrecruitmentapi.apiary-mock.com";this.ServerHealth=function(){return $resource(url+"/health",{}).get()},this.ListQuestions=function(offset,filter){return $resource(url+"/:questions",{questions:"questions"}).query({limit:10,offset:offset,filter:filter})},this.QuestionDetails=function(id){return $http.get(url+"/questions/"+id).then(function(response){return Promise.resolve(response)}).catch(function(err){return Promise.reject(err)})},this.UpvoteChoice=function(id){return $http.put(url+"/questions/"+id).then(function(response){return Promise.resolve(response)}).catch(function(err){return Promise.reject(err)})},this.Share=function(destination_email,content_url){return $http.post(url+"/share?"+destination_email+"&"+content_url).then(function(response){return Promise.resolve(response)}).catch(function(err){return Promise.reject(err)})}}]),blissApp.service("shareService",[function(){this.obj=null}]),blissApp.service("detailService",[function(){this.obj=null}]);